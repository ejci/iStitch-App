$(document).ready(function(){$("#app-mobile").empty();$("#app-desktop").show();$("#app-loader").hide();var j={content:[{route:"",content:"#app-desktop .content-home",visible:!1},{route:"/FAQ",content:"#app-desktop .content-faq",visible:!1},{route:"/Contact",content:"#app-desktop .content-contact",visible:!1},{route:"/:patterId",content:"#app-desktop .content-pattern",visible:!1}],getVisible:function(){for(var a=this.content.length,c=0;c<a;c++)if(this.content[c].visible)return this.content[c];return!1},
setVisible:function(a){for(var c=this.content.length,g=0;g<c;g++)this.content[g].visible=this.content[g].content==a?!0:!1},showContent:function(a){var c=j.getVisible();c?$(c.content).fadeOut(function(){$(a).fadeIn();h.shake()}):$(a).fadeIn();j.setVisible(a)}},h={show:function(){h.running=!0;$("#ribbon").animate({top:0},300).animate({top:-30},150).animate({top:-20},300,function(){h.running=!1})},shake:function(){if(!h.running){var a=function(a){return a?Math.floor(10*Math.random()+1):Math.floor(100*
Math.random()+1)};h.running=!0;$("#app-desktop #ribbon").animate({top:-20-a(!0)},100+a()).animate({top:-10-a(!0)},100+a()).animate({top:-20},100+a(),function(){h.running=!1})}}};setTimeout(function(){1E3<$(window).width()&&h.show()},1500);try{(/MSIE/i.test(navigator.userAgent)||/Opera/i.test(navigator.userAgent)||!window.CanvasRenderingContext2D||!document.createElement("canvas").getContext||!window.HTMLCanvasElement)&&$("#app-desktop .content-home .support").html($(".content-unsuportedBrowser").html())}catch(q){$("#app-desktop .content-home .support").html($(".content-unsuportedBrowser").html())}$("#app-desktop #colors").empty();
for(var k=0;k<palette.length;k++){var l=$('<label class="radio"></label>'),m=palette[k];l.append('<input type="radio" '+(m.def?"checked":"")+' name="colors" value="'+k+'">');for(var n=0;n<m.colors.length;n++){var p=m.colors[n];l.append('<span class="color" style="background-color: rgb('+p.r+", "+p.g+", "+p.b+')"></span>')}$("#app-desktop #colors").append(l)}$("#app-desktop #modalOptions input[name='cols']").val(50);var d={actual:1};d.max=$("#examples img").length;d.slide=function(){var a=d.actual,
c=3<a+1?1:a+1;d.actual=c;$("#app-desktop #examples .example"+a).fadeOut(700,function(){$("#app-desktop #examples .example"+c).fadeIn(700,function(){setTimeout(function(){d.slide()},3E3)})})};d.start=function(){setTimeout(function(){d.slide()},3E3)};d.start();$("#convertImage").click(function(){b.running||($("#app-desktop #canvas").empty(),$("#inputFile").click())});$("#inputFile").change(function(a){f.start(a.target.files[0])});$("#modalResult").on("hidden",function(){b.finish()});$("#sendMessage").click(function(){var a=
$("#messageSubject").val(),c=$("#messageBody").val();""!==a&&""!==c&&window.open("mailto:miroslav.magda@ejci.net?subject="+a+"&body="+c)});$("#buttonOptions").click(function(){$("#modalOptions").modal()});$("#buttonApplyOptions").click(function(){f.applyOptions()});$("#buttonDownload").click(function(){f.download()});$("#buttonDownloadShared").click(function(){$("#buttonDownload").click()});$("#buttonShare").click(function(){f.share()});$("#buttonEdit").click(function(){$("#modalAlert .modal-header h3").html("Comming Soon");
$("#modalAlert .modal-body").html('<p class="lead">Sorry :( Editing and sharing of patterns is under development :)</p>');$("#modalAlert").modal({show:!0})});var e={},f={start:function(a){a&&("image/jpeg"===a.type||"image/jpg"===a.type||"image/png"===a.type?(b.start(),canvasResize(a,{width:1600,height:1600,crop:!1,quality:100,callback:function(a,g,b){$("#image").attr("src",a);$("#image").attr("width",g);$("#image").attr("height",b);$("#image").load(function(){f.image()})}})):($("#modalAlert .modal-header h3").html("Sorry :("),
$("#modalAlert .modal-body").html('<p class="lead">You are trying to use unsuported file type.</p><p>Please use .jpeg, .jpg or .png file type.</p>'),$("#modalAlert").modal({show:!0})))},showResult:function(a,c){c=c?c:function(){};var g=a.getCanvas(),b=a.getPattern();$("#resultCanvasShare").hide();$("#resultCanvas").html(g);$("#resultCanvasInfo").html("<div><b>Size: </b>"+b.cols+" <small>x</small> "+b.rows+"<div>");for(var g=$("<div><b>Used colors: </b></div>"),e=0;e<b.colors.length;e++){var d=b.colors[e];
g.append('<span class="color" style="background-color: rgb('+d.r+", "+d.g+", "+d.b+')"></span>')}$("#resultCanvasInfo").append(g);$("#marketing").slideUp(500,function(){$("#result").slideDown(500);c()})},applyOptions:function(){$("#modalOptions").modal("hide");b.start();var a=$("#modalOptions input[name='cols']").val(),c=$("#modalOptions input[name='colors']:checked").val();e.processStitches({cols:100<parseInt(a,10)?100:parseInt(a,10),palette:c});f.showResult(e,function(){b.finish()})},download:function(){b.start();
var a=e.getCanvas({width:1200}).toDataURL("image/png");$("#downloadForm input[name='image']").val(a);$("#downloadForm").submit();b.finish()},share:function(){var a=JSON.stringify(e.getPattern());$.post("/share/save",{pattern:a}).fail(function(a){$("#modalAlert .modal-header h3").html("Sorry :(");$("#modalAlert .modal-body").html('<p class="lead">Something went wrong...</p><p>Error message:'+a+"</p>");$("#modalAlert").modal({show:!0})}).done(function(a){a="http://istitchapp.com/#/"+a.patternId;$("#resultCanvasShare input[name='shareUrl']").val(a);
$("#resultCanvasShare").slideDown(500)})},loadPattern:function(a){5>a.length?($("#sharedCanvas").html('<i class="icon-exclamation-sign icon-2x"></i><h4>There isn\'t such a pattern :(</h4><p>Check your link please</p>'),$("#sharedCanvasMeta").hide()):(e=new stitch(document.getElementById("image")),$.getJSON("share/load/"+a,function(a){if(a.error)$("#sharedCanvas").html('<i class="icon-exclamation-sign icon-2x"></i><h4>There isn\'t such a pattern :(</h4><p>Check your link please</p>'),$("#sharedCanvasMeta").hide();
else{var b=e.getCanvas(!1,a);$("#sharedCanvas").html(b);$("#sharedCanvasInfo").html("<div><b>Size: </b>"+a.cols+" <small>x</small> "+a.rows+"<div>");for(var b=$("<div><b>Used colors: </b></div>"),d=0;d<a.colors.length;d++){var f=a.colors[d];b.append('<span class="color" style="background-color: rgb('+f.r+", "+f.g+", "+f.b+')"></span>')}$("#sharedCanvasInfo").append(b);$("#sharedCanvasMeta").show(500)}}))},image:function(){try{b.start();var a=$("#modalOptions input[name='cols']").val(),c=$("#modalOptions input[name='colors']:checked").val();
e=new stitch(document.getElementById("image"));e.processStitches({cols:100<parseInt(a,10)?100:parseInt(a,10),palette:c});f.showResult(e,function(){b.finish()})}catch(d){b.finish(),$("#modalAlert .modal-header h3").html("Sorry :("),$("#modalAlert .modal-body").html('<p class="lead">Something went wrong...</p><p>Error message:'+JSON.stringify(d)+"</p>"),$("#modalAlert").modal({show:!0})}}},b={running:!1,count:0,start:function(){b.running=!0;$("#convertImage").addClass("disabled");$("#convertImage").removeClass("btn-success");
$("#convertImage").addClass("btn-danger");$("#convertImage").html('<i class="icon-spinner icon-spin"></i> Processing image...')},update:function(a){$("#convertImage").html(a)},finish:function(){$("#convertImage").removeClass("disabled");$("#convertImage").removeClass("btn-danger");$("#convertImage").addClass("btn-success");$("#convertImage").html('<i class="icon-camera"></i> Create another pattern from picture');b.running=!1;b.count++}};routie("/Contact",function(){j.showContent("#app-desktop .content-contact")});
routie("/FAQ",function(){j.showContent("#app-desktop .content-faq")});routie("/:patternId",function(a){j.showContent("#app-desktop .content-pattern");f.loadPattern(a)});routie("",function(){j.showContent("#app-desktop .content-home")})});
