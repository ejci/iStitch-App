var hash=window.location.hash;/mobile/i.test(hash)||3>hash.length||(window._patternId=hash.substr(2,100),window.location="#mobile-share");
$(document).ready(function(){var k,j;$("head").append('<meta name="viewport" content="width=device-width, initial-scale=1">');$("#mobile-faq .content").html($("#app-desktop .content-faq").html());$("#app-desktop").empty();$("#app-mobile").show();$("#app-loader").hide();k=j=void 0;j=navigator.userAgent.match(/(iPad|iPhone|iPod)/g)?!0:!1;k=navigator.userAgent.match(/android/i)?!0:!1;var g=j?$("#inputFile"):$("#inputMobileFile");j?$(".ios").show():k?$(".otherOs").show():$(".unsuportedOs").show();$("#sendMessageMobile").click(function(){var a=
$("#messageSubjectMobile").val(),d=$("#messageBodyMobile").val();""!==a&&""!==d&&window.open("mailto:miroslav.magda@ejci.net?subject="+a+"&body="+d)});$("#convertMobileImage").click(function(){$("#inputFile").trigger("click")});$("#buttonOptionsMobile").click(function(){$("#optionsPanel").panel("open")});$("#buttonApplyOptionsMobile").click(function(){$("#optionsPanel").panel("close");c.applyOptions()});$("#buttonSaveMobile").click(function(){c.download()});$("#buttonShareMobile").click(function(){c.share()});
$("#buttonSaveShareMobile").click(function(){$("#buttonSaveMobile").click()});g.change(function(a){c.start(a.target.files[0])});for(var e={},c={start:function(a){a&&("image/jpeg"===a.type||"image/jpg"===a.type?(b.start(),canvasResize(a,{width:100,height:100,crop:!1,quality:100,callback:function(a,b,h){$("#image").attr("src",a);$("#image").attr("width",b);$("#image").attr("height",h);$("#image").load(function(){c.image()})}})):alert("Sorry :( You are trying to use unsuported file type."))},share:function(){b.start();
var a=JSON.stringify(e.getPattern());$.post("/share/save",{pattern:a}).fail(function(){alert("Something went wrong...");b.finish()}).done(function(a){a="http://istitchapp.com/#/"+a.patternId;$("#resultCanvasShareMobile input[name='shareUrl']").val(a);$("#resultCanvasShareMobile").show();b.finish()})},showResult:function(a,d){d=d?d:function(){};var b=a.getCanvas(),h=a.getPattern();$("#resultCanvasShareMobile").hide();$("#resultCanvasMobile").html(b);$("#resultCanvasMobile canvas").css("width","80%");
$("#resultCanvasInfoMobile").html("<div><b>Size: </b>"+h.rows+" <small>x</small> "+h.cols+"<div>");for(var b=$("<div><b>Used colors: </b></div>"),e=0;e<h.colors.length;e++){var c=h.colors[e];b.append('<span class="color" style="background-color: rgb('+c.r+", "+c.g+", "+c.b+')"></span>')}$("#resultCanvasInfoMobile").append(b);$("#marketingMobile").slideUp(500,function(){$("#resultMobile").slideDown(500);d()})},applyOptions:function(){b.start();var a=$("#optionsPanel input[name='cols']").val(),d=$("#optionsPanel input[name='colors']:checked").val();
e.processStitches({cols:100<parseInt(a,10)?100:parseInt(a,10),palette:d});c.showResult(e,function(){b.finish()})},download:function(){b.start();var a=e.getCanvas({width:800}).toDataURL("image/png"),d=$('<form action="/download" target="_blank" method="POST"></form>'),a=$('<input name="image" type="text" value="'+a+'"/>');d.append(a);d.submit();b.finish()},loadPattern:function(a){$("#sharedCanvasMobile").show();5>a.length?($("#sharedCanvasMobile").html("<h4>There isn't such a pattern :(</h4><p>Check your link please</p>"),
$("#sharedCanvasMobile").hide()):(e=new stitch(document.getElementById("image")),$.getJSON("share/load/"+a,function(a){if(a.error)$("#sharedCanvasMobile").html("<h4>There isn't such a pattern :(</h4><p>Check your link please</p>"),$("#sharedCanvasMobile").hide();else{var b=e.getCanvas(!1,a);$("#sharedCanvasMobile").html(b);$("#sharedCanvasMobile canvas").css("width","80%");$("#sharedCanvasInfoMobile").html("<div><b>Size: </b>"+a.cols+" <small>x</small> "+a.rows+"<div>");for(var b=$("<div><b>Used colors: </b></div>"),
c=0;c<a.colors.length;c++){var f=a.colors[c];b.append('<span class="color" style="background-color: rgb('+f.r+", "+f.g+", "+f.b+')"></span>')}$("#sharedCanvasInfoMobile").append(b);$("#sharedCanvasMetaMobile").show(500)}}))},image:function(){try{b.start();var a=$("#optionsPanel input[name='cols']").val(),d=$("#optionsPanel input[name='colors']:checked").val();e=new stitch(document.getElementById("image"));e.processStitches({cols:100<parseInt(a,10)?100:parseInt(a,10),palette:d});c.showResult(e,function(){b.finish()})}catch(f){b.finish(),
alert("Sorry :( Something went wrong...")}}},b={running:!1,count:0,start:function(){b.running=!0;$.mobile.loading("show")},update:function(){},finish:function(){$.mobile.loading("hide");b.running=!1;b.count++}},g=0;g<palette.length;g++){var l=$('<label class="radio"></label>'),m=palette[g];l.append('<input type="radio" '+(m.def?"checked":"")+' name="colors" value="'+g+'">');for(var n=0;n<m.colors.length;n++){var p=m.colors[n];l.append('<span class="color" style="background-color: rgb('+p.r+", "+p.g+
", "+p.b+')"></span>')}$("#colorsMobile").append(l);$("#colorsMobile").append("<br /><br />")}window._patternId&&c.loadPattern(window._patternId);if(j||320<=$(window).width()&&k){var f={actual:1};f.max=$("#app-mobile .examples img").length;f.slide=function(){var a=f.actual,b=3<a+1?1:a+1;f.actual=b;$("#app-mobile .examples .example"+a).fadeOut(700,function(){$("#app-mobile .examples .example"+b).fadeIn(700,function(){setTimeout(function(){f.slide()},3E3)})})};f.start=function(){$("#app-mobile .examples").show();
setTimeout(function(){f.slide()},3E3)};f.start()}});
